import{u as J,c as K,a as Q,g as X,d as Y}from"./template-C7Odnroa.js";import{j as H,r as g,a as B,I as n,s as q,C as D,H as e,J as r,G as t,M as z,q as d,N as b,K as Z,L as ee,_ as W,v as ae,k as A,O as te}from"./index-D44JGiXO.js";import{u as oe,a as le}from"./main-C7zHEi-_.js";import{u as ne}from"./search-DtdETXK6.js";import"./request-BtFbWnpm.js";const I=x=>(Z("data-v-588952fe"),x=x(),ee(),x),ie=I(()=>d("div",null,[d("p",null,"路径部分以/分割，不能以/开始和结束，支持的字符：英数字_-"),d("p",null,"支持参数填充，参数用${}包裹，支持的字符：英数字，例如：${controllerId}，示例："),d("p",null,"src/main/java/controller/${controllerId}Controller.java")],-1)),se={class:"template-upload-container"},re=I(()=>d("div",{class:"upload-container"},[d("div",null,[r(" 拖拽文件到此处或 "),d("span",{style:{color:"#3370ff"}},"点击上传")])],-1)),de=I(()=>d("div",null,[r(" 支持 ftl 格式的模板文件，模板文件的编写，参照："),d("a",{style:{color:"#3370ff"},href:"http://freemarker.foofun.cn/",target:"_blank"},"FreeMarker")],-1)),pe={class:"template-upload-container"},ue=I(()=>d("div",{class:"upload-container"},[d("div",null,[r(" 拖拽文件到此处或 "),d("span",{style:{color:"#3370ff"}},"点击上传")])],-1)),ce=I(()=>d("div",null,[r(" 可选，支持 json 格式，文件内容示例： "),d("p",null,' [ { "name": "参数名（字符串）", "value": "参数值（任意类型）", "defaultValue": "默认值（任意类型）", "desc": "描述（字符串）", "enable": "是否启用（true 或 false）" } ] ')],-1)),me=H({__name:"UploadTemplate",emits:["upload-success"],setup(x,{expose:l,emit:w}){const u=g(!1),c=g(!1);let m=0;const s=B({projId:m,targetPath:"",templateFile:void 0,parameterFile:void 0}),h=w,y=g(),F={targetPath:[{required:!0,message:"生成代码的目标路径为必填项"},{validator:(a,o)=>{a.trim().length===0?o("生成代码的目标路径不能为空"):o()}}],templateFile:[{required:!0,message:"模板文件为必须上传的文件"}]},i=g(),_=g(),v=a=>{a.length>0?s.templateFile=a[0].file:s.templateFile=void 0},p=a=>new Promise((o,C)=>{a.name.endsWith(".ftl")?o(!0):(b.warning("请上传.ftl文件"),o(!1))}),P=a=>{a.length>0?s.parameterFile=a[0].file:s.parameterFile=void 0},j=a=>new Promise((o,C)=>{a.name.endsWith(".json")?o(!0):(b.warning("请上传.json文件"),o(!1))}),S=()=>{y.value.validate(a=>{if(a)b.warning("表单校验未通过，不可提交");else{c.value=!0;const o=new FormData;o.append("projId",m.toString()),o.append("targetPath",s.targetPath),s.templateFile!==void 0&&o.append("templateFile",s.templateFile),s.parameterFile!==void 0&&o.append("parameterFile",s.parameterFile),J(o).then(C=>{b.success("上传成功"),h("upload-success"),k()}).finally(()=>{c.value=!1})}})},N=a=>{u.value=!0,m=a},k=()=>{u.value=!1,y.value.resetFields()};return l({init:N}),(a,o)=>{const C=n("a-input"),$=n("a-form-item"),T=n("a-upload"),M=n("a-form"),O=n("a-button"),R=n("a-space"),U=n("a-modal");return q(),D(U,{width:"auto",visible:u.value,onCancel:k,unmountOnClose:""},{title:e(()=>[r("上传模板")]),footer:e(()=>[t(R,null,{default:e(()=>[t(O,{onClick:S,type:"primary",loading:c.value},{default:e(()=>[r(z(c.value?"处理中，请稍后":"上传"),1)]),_:1},8,["loading"])]),_:1})]),default:e(()=>[t(M,{ref_key:"uploadFormRef",ref:y,model:s,rules:F,style:{width:"800px"}},{default:e(()=>[t($,{field:"targetPath",label:"生成代码的目标路径",required:"","validate-trigger":"blur"},{extra:e(()=>[ie]),default:e(()=>[t(C,{"max-length":100,"allow-clear":"","show-word-limit":"",modelValue:s.targetPath,"onUpdate:modelValue":o[0]||(o[0]=L=>s.targetPath=L),placeholder:"输入生成代码的目标路径"},null,8,["modelValue"])]),_:1}),t($,{field:"templateFile",label:"模板文件",required:""},{extra:e(()=>[de]),default:e(()=>[d("div",se,[t(T,{draggable:"",ref_key:"templateFileUploadRef",ref:i,onChange:v,onBeforeUpload:p,"auto-upload":!1,limit:1,accept:".ftl"},{"upload-button":e(()=>[re]),_:1},512)])]),_:1}),t($,{label:"参数文件"},{extra:e(()=>[ce]),default:e(()=>[d("div",pe,[t(T,{draggable:"",ref_key:"parameterFileUploadRef",ref:_,onChange:P,onBeforeUpload:j,"auto-upload":!1,limit:1,accept:".json"},{"upload-button":e(()=>[ue]),_:1},512)])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])}}}),_e=W(me,[["__scopeId","data-v-588952fe"]]),fe=H({__name:"AddProj",emits:["create-success"],setup(x,{expose:l,emit:w}){const u=g(!1),c=g(!1),m=w,s=g(),h=B({projName:void 0,desc:void 0}),y={projName:[{required:!0,message:"工程名为必填项"},{validator:(v,p)=>{v.trim().length===0?p("工程名不能为空"):p()}}],desc:[{validator:(v,p)=>{v&&v.trim().length===0?p("描述不能为空"):p()}}]},F=()=>{u.value=!1,s.value.resetFields()},i=()=>{s.value.validate(v=>{v?b.warning("表单校验未通过，不可提交"):(c.value=!0,K(h).then(p=>{b.success("创建成功"),F(),m("create-success")}).finally(()=>{c.value=!1}))})};return l({init:()=>{u.value=!0}}),(v,p)=>{const P=n("a-input"),j=n("a-form-item"),S=n("a-textarea"),N=n("a-form"),k=n("a-button"),a=n("a-space"),o=n("a-modal");return q(),D(o,{width:"auto",visible:u.value,onCancel:F,unmountOnClose:""},{title:e(()=>[r("创建工程")]),footer:e(()=>[t(a,null,{default:e(()=>[t(k,{type:"primary",loading:c.value,onClick:i},{default:e(()=>[r(z(c.value?"处理中，请稍后":"创建"),1)]),_:1},8,["loading"])]),_:1})]),default:e(()=>[t(N,{ref_key:"formRef",ref:s,model:h,rules:y,style:{width:"600px"}},{default:e(()=>[t(j,{field:"projName",label:"工程名",required:"","validate-trigger":"blur"},{default:e(()=>[t(P,{"max-length":50,"allow-clear":"","show-word-limit":"",modelValue:h.projName,"onUpdate:modelValue":p[0]||(p[0]=C=>h.projName=C),placeholder:"输入工程名"},null,8,["modelValue"])]),_:1}),t(j,{field:"desc",label:"描述"},{default:e(()=>[t(S,{"max-length":150,"allow-clear":"","show-word-limit":"",modelValue:h.desc,"onUpdate:modelValue":p[1]||(p[1]=C=>h.desc=C),"auto-size":{minRows:2,maxRows:5},placeholder:"输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])}}}),ge=d("div",null,[d("p",null,"支持的字符：英数字、下划线_、短横线-")],-1),ve=H({__name:"AddTemplate",setup(x,{expose:l}){const w=g(!1),u=g(!1),c=g(),m=B({projId:void 0,targetPath:void 0,templateName:void 0}),s={targetPath:[{required:!0,message:"生成代码的目标路径为必填项"},{validator:(i,_)=>{i.trim().length===0?_("生成代码的目标路径不能为空"):_()}}],templateName:[{required:!0,message:"模板名称为必填项"},{validator:(i,_)=>{i&&i.trim().length===0?_("模板名称不能为空"):_()}}]},h=()=>{w.value=!1,c.value.resetFields()},y=()=>{c.value.validate(i=>{i?b.warning("表单校验未通过，不可提交"):(u.value=!0,Q(m).then(_=>{b.success("创建成功"),h()}).finally(()=>{u.value=!1}))})};return l({init:i=>{w.value=!0,m.projId=i}}),(i,_)=>{const v=n("a-input"),p=n("a-form-item"),P=n("a-form"),j=n("a-button"),S=n("a-space"),N=n("a-modal");return q(),D(N,{width:"auto",visible:w.value,onCancel:h,unmountOnClose:""},{title:e(()=>[r("创建模板")]),footer:e(()=>[t(S,null,{default:e(()=>[t(j,{type:"primary",loading:u.value,onClick:y},{default:e(()=>[r(z(u.value?"处理中，请稍后":"创建"),1)]),_:1},8,["loading"])]),_:1})]),default:e(()=>[t(P,{ref_key:"formRef",ref:c,model:m,rules:s,style:{width:"800px"}},{default:e(()=>[t(p,{field:"targetPath",label:"生成代码的目标路径",required:"","validate-trigger":"blur"},{extra:e(()=>[ge]),default:e(()=>[t(v,{"allow-clear":"","show-word-limit":"",modelValue:m.targetPath,"onUpdate:modelValue":_[0]||(_[0]=k=>m.targetPath=k),placeholder:"输入生成代码的目标路径"},null,8,["modelValue"])]),_:1}),t(p,{field:"templateName",label:"模板名称"},{default:e(()=>[t(v,{"allow-clear":"","show-word-limit":"",modelValue:m.templateName,"onUpdate:modelValue":_[1]||(_[1]=k=>m.templateName=k),"auto-size":{minRows:2,maxRows:5},placeholder:"输入模板名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])}}}),he={class:"operator-container"},we={key:0},Ce={key:1},ke=H({__name:"index",setup(x){const l=B({loading:!1,dataList:[],selectedRow:[],pagination:{total:0,current:1,pageSize:10,showPageSize:!0,showTotal:!0}}),w=g(!1),u=le(),c=g(),m=g(),s=g();ae(()=>{const a=oe();a.query.current&&(l.pagination.current=Number(a.query.current)),a.query.pageSize&&(l.pagination.pageSize=Number(a.query.pageSize)),a.query.selectedRow&&(l.selectedRow=[a.query.selectedRow]),i("")}),ne().$subscribe((a,o)=>{i(o.projName)});const y=a=>{l.pagination.current=a,i("")},F=a=>{l.pagination.pageSize=a,i("")},i=a=>{l.loading=!0,X(a,l.pagination.current,l.pagination.pageSize).then(o=>{l.dataList=o.data.pageData,l.pagination.total=o.data.total}).finally(()=>{l.loading=!1})},_=a=>{u.push({path:"/ui/template/view",query:{projId:a.id,projName:a.name,current:l.pagination.current,pageSize:l.pagination.pageSize}})},v=a=>{u.push({path:"/ui/template/parameter",query:{projId:a.id,projName:a.name,current:l.pagination.current,pageSize:l.pagination.pageSize}})},p=a=>{u.push({path:"/ui/template/generator",query:{projId:a.id,projName:a.name,current:l.pagination.current,pageSize:l.pagination.pageSize}})},P=a=>{c.value.init(a)},j=a=>{s.value.init(a)},S=(a,o)=>{te.warning({title:`确定删除工程：${o} ?`,content:"删除后将不可恢复，请谨慎操作。",okLoading:w.value,okButtonProps:{status:"danger"},hideCancel:!1,onOk:()=>{w.value=!0,Y(a).then(C=>{b.success("删除成功"),i("")}).finally(()=>{w.value=!1})}})},N=()=>{m.value.init()},k=()=>{l.selectedRow=[],l.pagination.current=1,l.pagination.pageSize=10,u.push("/ui/template"),i("")};return(a,o)=>{const C=n("icon-plus"),$=n("a-button"),T=n("icon-refresh"),M=n("a-space"),O=n("a-link"),R=n("a-table-column"),U=n("a-doption"),L=n("a-dropdown-button"),E=n("a-table"),G=n("a-card");return q(),D(G,null,{default:e(()=>[d("div",he,[t(M,null,{default:e(()=>[t($,{type:"primary",onClick:N},{icon:e(()=>[t(C)]),default:e(()=>[r("创建工程")]),_:1}),t($,{type:"primary",onClick:k},{icon:e(()=>[t(T)]),default:e(()=>[r("重置")]),_:1})]),_:1})]),t(E,{data:l.dataList,loading:l.loading,pagination:l.pagination,"selected-keys":l.selectedRow,"row-key":"name",onPageChange:y,onPageSizeChange:F},{columns:e(()=>[t(R,{title:"工程名"},{cell:e(({record:f})=>[t(O,{href:f.webUrl,icon:""},{default:e(()=>[r(z(f.name),1)]),_:2},1032,["href"])]),_:1}),t(R,{title:"描述",ellipsis:"",tooltip:""},{cell:e(({record:f})=>[f.description?(q(),A("span",we,z(f.description),1)):(q(),A("span",Ce,"-"))]),_:1}),t(R,{title:"作者","data-index":"author"}),t(R,{title:"版本","data-index":"version"}),t(R,{title:"创建时间","data-index":"createdAt"}),t(R,{title:"操作"},{cell:e(({record:f})=>[t(L,{onClick:V=>p(f)},{content:e(()=>[t(U,{onClick:V=>_(f)},{default:e(()=>[r("查看模板")]),_:2},1032,["onClick"]),t(U,{onClick:V=>v(f)},{default:e(()=>[r("查看参数")]),_:2},1032,["onClick"]),t(U,{onClick:V=>P(f.id)},{default:e(()=>[r("上传模板")]),_:2},1032,["onClick"]),t(U,{onClick:V=>j(f.id)},{default:e(()=>[r("创建模板")]),_:2},1032,["onClick"]),t(U,{onClick:V=>S(f.id,f.name)},{default:e(()=>[r("删除工程")]),_:2},1032,["onClick"])]),default:e(()=>[r(" 生成代码 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","loading","pagination","selected-keys"]),t(_e,{ref_key:"uploadTemplateRef",ref:c,onUploadSuccess:o[0]||(o[0]=f=>i(""))},null,512),t(fe,{ref_key:"addProjRef",ref:m,onCreateSuccess:o[1]||(o[1]=f=>i(""))},null,512),t(ve,{ref_key:"addTemplateRef",ref:s},null,512)]),_:1})}}}),Fe=W(ke,[["__scopeId","data-v-d83e5921"]]);export{Fe as default};
