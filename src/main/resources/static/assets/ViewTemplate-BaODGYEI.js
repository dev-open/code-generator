import{j as Z,r as s,v as ee,f as te,C as S,H as t,I as n,s as m,G as a,q as h,R,J as T,k as D,Q as ae,P as oe,M as V,K as ne,L as le,N as g,_ as se}from"./index-D44JGiXO.js";import{h as ce,i as re,j as ie,k as ue}from"./template-Cj246IWW.js";import{u as pe}from"./template-BMkKIAyf.js";import{a as de,u as _e}from"./main-BZPE1GXX.js";import"./request-DlYiW6MC.js";const me=f=>(ne("data-v-e7f91ed8"),f=f(),le(),f),he=me(()=>h("span",{class:"template-title"},"模板",-1)),fe={class:"template-search-container"},ve={class:"template-info-container"},ge={key:0},ye=["onDblclick"],be=Z({__name:"ViewTemplate",setup(f){const c=s([]),x=pe(),y=de(),r=s(!1),u=s(""),b=s(""),E=s(1),B=s(10),k=s(""),C=s();ee(()=>{const e=_e();u.value=e.query.projId,b.value=e.query.projName,E.value=e.query.current,B.value=e.query.pageSize,v()});const q=()=>{y.push({path:"/ui/template",query:{current:E.value,pageSize:B.value,selectedRow:b.value}})},z=te(()=>c.value.map(e=>e.templateName)),v=()=>{r.value=!0,ce(u.value).then(e=>{c.value.length=0,e.data.forEach(l=>{l.targetPathEditable=!1,c.value.push(l)})}).finally(()=>{r.value=!1})},K=(e,l)=>{re({projId:u.value,templatePath:e}).then(i=>{var p;x.$patch({projId:u,path:e,name:l,content:i.data.templateContent}),x.saveData();const P=y.resolve({path:(p=y.getRoutes().filter(w=>w.name=="Editor")[0].path)==null?void 0:p.toString()}),d=window.open(P.href,"_blank");d&&(d.onload=()=>{d.document.title="在线编辑 -"+l})})},$=e=>{r.value=!0,ie(u.value,e).then(()=>{g.success("删除成功"),v()}).finally(()=>{r.value=!1})},I=e=>{C.value.blur();const l=c.value.filter(i=>i.templateName.includes(k.value));c.value.length=0,c.value.push(...l)},U=e=>{e&&e.focus()},L=(e,l)=>{e.targetPathEditable=!0},M=e=>{const l=e.targetPath;if(l.length==0){g.warning("生成代码的目标路径为必填项");return}if(l.trim().length==0){g.warning("生成代码的目标路径不能为空");return}r.value=!0,ue({projId:u.value,templatePath:e.templatePath,targetPath:e.targetPath}).then(i=>{g.success("更新成功"),e.targetPathEditable=!1,v()}).catch(i=>{}).finally(()=>{r.value=!1})};return(e,l)=>{const i=n("a-page-header"),P=n("a-auto-complete"),d=n("icon-refresh"),p=n("a-button"),w=n("icon-font"),N=n("a-descriptions-item"),Q=n("a-input"),O=n("a-tooltip"),F=n("a-descriptions"),G=n("a-list-item-meta"),H=n("icon-edit"),J=n("icon-delete"),W=n("a-popconfirm"),A=n("a-list-item"),X=n("a-list"),Y=n("a-card");return m(),S(Y,null,{default:t(()=>[a(i,{subtitle:b.value,onBack:q},{title:t(()=>[he]),_:1},8,["subtitle"]),h("div",fe,[a(P,{ref_key:"templateSearchRef",ref:C,data:z.value,onKeyup:R(I,["enter"]),onBlur:I,style:{width:"320px"},modelValue:k.value,"onUpdate:modelValue":l[0]||(l[0]=o=>k.value=o),placeholder:"输入模板名称","allow-clear":""},null,8,["data","modelValue"]),a(p,{class:"reset-button",type:"primary",onClick:v},{icon:t(()=>[a(d)]),default:t(()=>[T("重置")]),_:1})]),a(X,{loading:r.value},{default:t(()=>[(m(!0),D(oe,null,ae(c.value,(o,j)=>(m(),S(A,{style:{overflow:"auto"},key:o.templateName},{actions:t(()=>[a(p,{type:"text",onClick:_=>K(o.templatePath,o.templateName)},{icon:t(()=>[a(H)]),_:2},1032,["onClick"]),a(W,{content:"此操作将不可恢复，确定删除？",type:"warning",position:"br",onOk:_=>$(o.templatePath),"ok-button-props":{status:"danger"},"cancel-button-props":{type:"primary"}},{default:t(()=>[a(p,{type:"text",status:"danger"},{icon:t(()=>[a(J)]),_:1})]),_:2},1032,["onOk"])]),default:t(()=>[a(G,null,{avatar:t(()=>[a(w,{icon:"mobanku",class:"template-icon"})]),description:t(()=>[a(F,{title:"模板信息 - "+(j+1),column:2,size:"small"},{default:t(()=>[a(N,{label:"名称"},{default:t(()=>[T(V(o.templateName),1)]),_:2},1024),a(N,{label:"路径"},{default:t(()=>[T(V(o.templatePath),1)]),_:2},1024),a(N,{label:"生成代码的目标路径",span:2},{default:t(()=>[h("div",ve,[o.targetPathEditable?(m(),D("div",ge,[a(Q,{style:{height:"32px"},"max-length":100,"show-word-limit":"",size:"small",ref_for:!0,ref:U,onKeyup:R(_=>M(o),["enter"]),onBlur:()=>o.targetPathEditable=!1,modelValue:o.targetPath,"onUpdate:modelValue":_=>o.targetPath=_,placeholder:"输入生成代码的目标路径"},null,8,["onKeyup","onBlur","modelValue","onUpdate:modelValue"])])):(m(),S(O,{key:1,content:o.targetPath,position:"bottom"},{default:t(()=>[h("div",{onDblclick:_=>L(o,j)},[h("span",null,V(o.targetPath),1)],40,ye)]),_:2},1032,["content"]))])]),_:2},1024)]),_:2},1032,["title"])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["loading"])]),_:1})}}}),Te=se(be,[["__scopeId","data-v-e7f91ed8"]]);export{Te as default};
