import{j as L,r as d,a as J,C as B,H as a,I as t,s as b,J as p,G as e,M as G,q as u,N as h,v as ye,f as Ve,k as Q,P as A,R as we,Q as be,K as ke,L as xe,_ as Se}from"./index-D44JGiXO.js";import{a as Re,u as Pe}from"./main-BZPE1GXX.js";import{l as Ce,u as Ue}from"./useFullScreen-C_pV-m66.js";import{b as je,e as qe,s as Ne,f as Ie}from"./template-Cj246IWW.js";import"./request-DlYiW6MC.js";const Be=u("div",null,[u("p",null,"支持的字符：英数字")],-1),Fe=L({__name:"AddParameter",emits:["create-success"],setup(k,{expose:v,emit:x}){const c=d(!1),y=d(!1),i=x;let g;const V=d(),_=J({name:void 0,enable:!0,desc:void 0}),U={name:[{required:!0,message:"参数名为必填项"},{validator:(n,r)=>{n.trim().length===0?r("参数名不能为空"):r()}}],desc:[{required:!0,message:"描述为必填项"},{validator:(n,r)=>{n&&n.trim().length===0?r("描述不能为空"):r()}}]},S=()=>{c.value=!1,V.value.resetFields()},F=()=>{V.value.validate(n=>{n?h.warning("表单校验未通过，不可提交"):(y.value=!0,console.log(g),je(g,_).then(r=>{h.success("添加成功"),S(),i("create-success")}).finally(()=>{y.value=!1}))})};return v({init:n=>{c.value=!0,g=n}}),(n,r)=>{const z=t("a-input"),j=t("a-form-item"),q=t("a-textarea"),E=t("a-form"),R=t("a-button"),O=t("a-space"),T=t("a-modal");return b(),B(T,{width:"auto",visible:c.value,onCancel:S,unmountOnClose:""},{title:a(()=>[p("添加模板参数")]),footer:a(()=>[e(O,null,{default:a(()=>[e(R,{type:"primary",loading:y.value,onClick:F},{default:a(()=>[p(G(y.value?"处理中，请稍后":"添加"),1)]),_:1},8,["loading"])]),_:1})]),default:a(()=>[e(E,{ref_key:"formRef",ref:V,model:_,rules:U,style:{width:"600px"}},{default:a(()=>[e(j,{field:"name",label:"参数名"},{extra:a(()=>[Be]),default:a(()=>[e(z,{"allow-clear":"","max-length":20,"show-word-limit":"",modelValue:_.name,"onUpdate:modelValue":r[0]||(r[0]=P=>_.name=P),placeholder:"输入参数名"},null,8,["modelValue"])]),_:1}),e(j,{field:"desc",label:"描述"},{default:a(()=>[e(q,{"max-length":150,"show-word-limit":"",modelValue:_.desc,"onUpdate:modelValue":r[1]||(r[1]=P=>_.desc=P),placeholder:"输入描述","auto-size":{minRows:2,maxRows:5},"allow-clear":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])}}}),H=k=>(ke("data-v-65ffa3dd"),k=k(),xe(),k),ze=H(()=>u("span",{class:"parameter-title"},"模板参数",-1)),Ee={class:"tool-container"},Oe={class:"left"},Te={class:"right"},$e=H(()=>u("span",{style:{"margin-left":"8px"}},"添加模板参数",-1)),De={class:"param-form-container"},Je={class:"json-editor-container"},Ke={class:"full-screen-container"},Me={class:"operation-button-container"},Qe=L({__name:"ViewParameter",setup(k){const v=d(""),x=d(""),c=J([]),y=Re(),i=d(!1),g=d(""),V=d(),_=d(1),U=d(10),S=d(),F={desc:[{required:!0,message:"描述为必填项"},{validator:(o,l)=>{o.trim().length===0?l("描述不能为空"):l()}}]},K=()=>{y.push({path:"/ui/template",query:{current:_.value,pageSize:U.value,selectedRow:x.value}})};ye(()=>{const o=Pe();v.value=o.query.projId,x.value=o.query.projName,_.value=o.query.current,U.value=o.query.pageSize,n()});const n=()=>{g.value="",i.value=!0,qe(v.value).then(o=>{c.length=0,o.data.forEach(l=>{c.push(l)})}).finally(()=>{i.value=!1})},r=Ve(()=>c.map(o=>o.name)),z=o=>{if(o.errors){h.warning("表单校验未通过，不可提交");return}i.value=!0;const l={},m=Ce.cloneDeep(o.values);let N=!0;try{m.defaultValue&&(m.defaultValue=m.defaultValue.length===0?null:JSON.parse(m.defaultValue))}catch{N=!1,h.warning("无效的JSON数据")}if(!N){i.value=!1;return}l.parameters=[m],Ne(v.value,l).then($=>{h.success("更新成功"),n()}).finally(()=>{i.value=!1})},j=o=>{i.value=!0,Ie(v.value,o).then(()=>{}).finally(()=>{h.success("删除成功"),n(),i.value=!1})},q=o=>{V.value.blur();const l=c.filter(m=>m.name.includes(g.value));c.length=0,c.push(...l)},{handleFullScreen:E}=Ue(),R=J([]),O=o=>{R.push(o)},T=o=>{console.log(R[o]),E(R[o])},P=o=>new Promise((l,m)=>{o.name.endsWith(".json")?l(!0):(h.warning("请上传.json文件"),l(!1))}),W=o=>{h.success("导入成功"),n()},X=o=>{h.error(o.response.message)},Y=()=>{S.value.init(v.value)};return(o,l)=>{const m=t("a-page-header"),N=t("a-auto-complete"),$=t("icon-refresh"),w=t("a-button"),Z=t("icon-plus"),ee=t("a-doption"),ae=t("a-dropdown"),te=t("icon-import"),oe=t("a-upload"),M=t("a-space"),le=t("a-empty"),ne=t("a-tag"),se=t("a-input"),C=t("a-form-item"),I=t("a-col"),re=t("a-switch"),D=t("a-row"),ce=t("icon-fullscreen"),ue=t("a-tooltip"),de=t("monaco-editor"),ie=t("a-textarea"),me=t("a-popconfirm"),pe=t("a-form"),_e=t("a-collapse-item"),fe=t("a-collapse"),he=t("a-spin"),ve=t("a-card");return b(),Q(A,null,[e(ve,null,{default:a(()=>[e(m,{subtitle:x.value,onBack:K},{title:a(()=>[ze]),_:1},8,["subtitle"]),u("div",Ee,[u("div",Oe,[e(N,{ref_key:"paramSearchRef",ref:V,data:r.value,style:{width:"320px"},modelValue:g.value,"onUpdate:modelValue":l[0]||(l[0]=s=>g.value=s),onKeyup:we(q,["enter"]),onBlur:q,placeholder:"输入参数名","allow-clear":""},null,8,["data","modelValue"]),e(w,{class:"reset-button",type:"primary",onClick:n},{icon:a(()=>[e($)]),default:a(()=>[p("重置")]),_:1})]),u("div",Te,[e(M,null,{default:a(()=>[e(ae,{"popup-max-height":!1},{content:a(()=>[e(ee,{style:{color:"#545968"},onClick:Y},{default:a(()=>[e(Z),$e]),_:1})]),default:a(()=>[e(w,null,{default:a(()=>[p("更多")]),_:1})]),_:1}),e(oe,{action:"/code/gen/api/template/parameters/"+v.value+"/import",limit:1,onBeforeUpload:P,onSuccess:W,onError:X,accept:".json"},{"upload-button":a(()=>[e(w,{type:"primary"},{icon:a(()=>[e(te)]),default:a(()=>[p("导入模板参数")]),_:1})]),_:1},8,["action"])]),_:1})])]),e(he,{loading:i.value,tip:"处理中，请稍后",style:{width:"100%"}},{default:a(()=>[c.length==0?(b(),B(le,{key:0})):(b(),B(fe,{key:1,"expand-icon-position":"right",accordion:""},{default:a(()=>[(b(!0),Q(A,null,be(c,(s,ge)=>(b(),B(_e,{key:s.name},{header:a(()=>[e(ne,null,{default:a(()=>[p("参数 - "+G(s.name),1)]),_:2},1024)]),default:a(()=>[u("div",De,[e(pe,{model:s,rules:F,onSubmit:z,layout:"vertical"},{default:a(()=>[e(D,{gutter:16},{default:a(()=>[e(I,{span:16},{default:a(()=>[e(C,{field:"name",label:"参数名",disabled:""},{default:a(()=>[e(se,{modelValue:s.name,"onUpdate:modelValue":f=>s.name=f,placeholder:"输入参数名"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),e(I,{span:8},{default:a(()=>[e(C,{field:"enable",label:"是否启用"},{default:a(()=>[e(re,{"checked-color":"rgb(var(--arcoblue-5))",type:"round",modelValue:s.enable,"onUpdate:modelValue":f=>s.enable=f},{checked:a(()=>[p("启用")]),unchecked:a(()=>[p("禁用")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(D,{gutter:16},{default:a(()=>[e(I,{span:24},{default:a(()=>[e(C,{field:"defaultValue",label:"默认值"},{default:a(()=>[u("div",Je,[u("div",Ke,[e(ue,{content:"进入全屏模式"},{default:a(()=>[e(w,{type:"text",size:"small",onClick:f=>T(ge)},{icon:a(()=>[e(ce)]),_:2},1032,["onClick"])]),_:2},1024)]),u("div",{class:"editor-container",ref_for:!0,ref:O},[e(de,{modelValue:s.defaultValue,"onUpdate:modelValue":f=>s.defaultValue=f,editorOption:{minimap:{enabled:!1}},language:"json"},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(D,{gutter:16},{default:a(()=>[e(I,{span:24},{default:a(()=>[e(C,{field:"desc",label:"描述",required:""},{default:a(()=>[e(ie,{"max-length":150,"show-word-limit":"",modelValue:s.desc,"onUpdate:modelValue":f=>s.desc=f,placeholder:"无描述","auto-size":{minRows:2,maxRows:5},"allow-clear":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),e(C,null,{default:a(()=>[u("div",Me,[e(M,null,{default:a(()=>[e(w,{type:"primary","html-type":"submit"},{default:a(()=>[p("更新")]),_:1}),e(me,{content:"此操作将不可恢复，确定删除？",type:"warning",position:"br",onOk:f=>j(s.name),"ok-button-props":{status:"danger"},"cancel-button-props":{type:"primary"}},{default:a(()=>[e(w,{type:"primary",status:"danger"},{default:a(()=>[p("删除")]),_:1})]),_:2},1032,["onOk"])]),_:2},1024)])]),_:2},1024)]),_:2},1024)]),_:2},1032,["model"])])]),_:2},1024))),128))]),_:1}))]),_:1},8,["loading"])]),_:1}),e(Fe,{ref_key:"addParameterRef",ref:S,onCreateSuccess:l[1]||(l[1]=s=>n())},null,512)],64)}}}),Xe=Se(Qe,[["__scopeId","data-v-65ffa3dd"]]);export{Xe as default};
