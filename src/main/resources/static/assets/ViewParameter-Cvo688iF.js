import{j as ue,r as p,a as B,v as de,f as pe,C as k,H as e,I as o,s as g,G as a,q as c,R as ie,J as i,k as _e,Q as me,P as fe,N as _,M as he,K as ve,L as ge,_ as ye}from"./index-D44JGiXO.js";import{a as Ve,u as be}from"./main-CMpDet3E.js";import{l as we,u as ke}from"./useFullScreen-C_pV-m66.js";import{a as xe,s as Se,b as Ue}from"./template-CMjDBlDr.js";import"./request-ChAdx2Kn.js";const Pe=y=>(ve("data-v-92f6bf2a"),y=y(),ge(),y),je=Pe(()=>c("span",{class:"parameter-title"},"模板参数",-1)),Re={class:"tool-container"},Ne={class:"left"},qe={class:"right"},Be={class:"param-form-container"},Ce={class:"json-editor-container"},Ie={class:"full-screen-container"},Fe={class:"operation-button-container"},Ee=ue({__name:"ViewParameter",setup(y){const m=p(""),x=p(""),u=B([]),C=Ve(),d=p(!1),V=p(""),j=p(),R=p(1),N=p(10),I={desc:[{required:!0,message:"描述为必填项"},{validator:(t,l)=>{t.trim().length===0?l("描述不能为空"):l()}}]},F=()=>{C.push({path:"/ui/template",query:{current:R.value,pageSize:N.value,selectedRow:x.value}})};de(()=>{const t=be();m.value=t.query.projId,x.value=t.query.projName,R.value=t.query.current,N.value=t.query.pageSize,f()});const f=()=>{V.value="",d.value=!0,xe(m.value).then(t=>{u.length=0,t.data.forEach(l=>{u.push(l)})}).finally(()=>{d.value=!1})},E=pe(()=>u.map(t=>t.name)),z=t=>{if(t.errors){_.warning("表单校验未通过，不可提交");return}d.value=!0;const l={},s=we.cloneDeep(t.values);let b=!0;try{s.defaultValue&&(s.defaultValue=s.defaultValue.length===0?null:JSON.parse(s.defaultValue))}catch{b=!1,_.warning("无效的JSON数据")}if(!b){d.value=!1;return}l.parameters=[s],Se(m.value,l).then(U=>{_.success("更新成功"),f()}).finally(()=>{d.value=!1})},O=t=>{d.value=!0,Ue(m.value,t).then(()=>{}).finally(()=>{_.success("删除成功"),f(),d.value=!1})},q=t=>{j.value.blur();const l=u.filter(s=>s.name.includes(V.value));u.length=0,u.push(...l)},{handleFullScreen:T}=ke(),S=B([]),D=t=>{S.push(t)},J=t=>{console.log(S[t]),T(S[t])},K=t=>new Promise((l,s)=>{t.name.endsWith(".json")?l(!0):(_.warning("请上传.json文件"),l(!1))}),M=t=>{_.success("导入成功"),f()},Q=t=>{_.error(t.response.message)};return(t,l)=>{const s=o("a-page-header"),b=o("a-auto-complete"),U=o("icon-refresh"),h=o("a-button"),L=o("icon-import"),$=o("a-upload"),G=o("a-empty"),H=o("a-tag"),W=o("a-input"),v=o("a-form-item"),w=o("a-col"),A=o("a-switch"),P=o("a-row"),X=o("icon-fullscreen"),Y=o("a-tooltip"),Z=o("monaco-editor"),ee=o("a-textarea"),ae=o("a-popconfirm"),te=o("a-space"),oe=o("a-form"),le=o("a-collapse-item"),ne=o("a-collapse"),se=o("a-spin"),re=o("a-card");return g(),k(re,null,{default:e(()=>[a(s,{subtitle:x.value,onBack:F},{title:e(()=>[je]),_:1},8,["subtitle"]),c("div",Re,[c("div",Ne,[a(b,{ref_key:"paramSearchRef",ref:j,data:E.value,style:{width:"320px"},modelValue:V.value,"onUpdate:modelValue":l[0]||(l[0]=n=>V.value=n),onKeyup:ie(q,["enter"]),onBlur:q,placeholder:"输入参数名","allow-clear":""},null,8,["data","modelValue"]),a(h,{class:"reset-button",type:"primary",onClick:f},{icon:e(()=>[a(U)]),default:e(()=>[i("重置")]),_:1})]),c("div",qe,[a($,{action:"/code/gen/api/template/parameters/"+m.value+"/import",limit:1,onBeforeUpload:K,onSuccess:M,onError:Q,accept:".json"},{"upload-button":e(()=>[a(h,{type:"primary"},{icon:e(()=>[a(L)]),default:e(()=>[i("导入模板参数")]),_:1})]),_:1},8,["action"])])]),u.length==0?(g(),k(G,{key:0})):(g(),k(se,{key:1,loading:d.value,tip:"处理中，请稍后",style:{width:"100%"}},{default:e(()=>[a(ne,{"expand-icon-position":"right",accordion:""},{default:e(()=>[(g(!0),_e(fe,null,me(u,(n,ce)=>(g(),k(le,{key:n.name},{header:e(()=>[a(H,null,{default:e(()=>[i("参数 - "+he(n.name),1)]),_:2},1024)]),default:e(()=>[c("div",Be,[a(oe,{model:n,rules:I,onSubmit:z},{default:e(()=>[a(P,{gutter:16},{default:e(()=>[a(w,{span:16},{default:e(()=>[a(v,{field:"name",label:"参数名","label-col-flex":"100px",disabled:""},{default:e(()=>[a(W,{modelValue:n.name,"onUpdate:modelValue":r=>n.name=r,placeholder:"输入参数名"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a(w,{span:8},{default:e(()=>[a(v,{field:"enable",label:"是否启用","label-col-flex":"80px"},{default:e(()=>[a(A,{"checked-color":"rgb(var(--arcoblue-5))",type:"round",modelValue:n.enable,"onUpdate:modelValue":r=>n.enable=r},{checked:e(()=>[i("启用")]),unchecked:e(()=>[i("禁用")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(P,{gutter:16},{default:e(()=>[a(w,{span:24},{default:e(()=>[a(v,{field:"defaultValue",label:"默认值","label-col-flex":"80px"},{default:e(()=>[c("div",Ce,[c("div",Ie,[a(Y,{content:"进入全屏模式"},{default:e(()=>[a(h,{type:"text",size:"small",onClick:r=>J(ce)},{icon:e(()=>[a(X)]),_:2},1032,["onClick"])]),_:2},1024)]),c("div",{class:"editor-container",ref_for:!0,ref:D},[a(Z,{modelValue:n.defaultValue,"onUpdate:modelValue":r=>n.defaultValue=r,editorOption:{minimap:{enabled:!1}},language:"json"},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(P,{gutter:16},{default:e(()=>[a(w,{span:24},{default:e(()=>[a(v,{field:"desc",label:"描述","label-col-flex":"80px",required:""},{default:e(()=>[a(ee,{"max-length":150,"show-word-limit":"",modelValue:n.desc,"onUpdate:modelValue":r=>n.desc=r,placeholder:"无描述","auto-size":{minRows:2,maxRows:5},"allow-clear":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a(v,null,{default:e(()=>[c("div",Fe,[a(te,null,{default:e(()=>[a(h,{type:"primary","html-type":"submit"},{default:e(()=>[i("更新")]),_:1}),a(ae,{content:"此操作将不可恢复，确定删除？",type:"warning",position:"br",onOk:r=>O(n.name),"ok-button-props":{status:"danger"},"cancel-button-props":{type:"primary"}},{default:e(()=>[a(h,{type:"primary",status:"danger"},{default:e(()=>[i("删除")]),_:1})]),_:2},1032,["onOk"])]),_:2},1024)])]),_:2},1024)]),_:2},1024)]),_:2},1032,["model"])])]),_:2},1024))),128))]),_:1})]),_:1},8,["loading"]))]),_:1})}}}),Ke=ye(Ee,[["__scopeId","data-v-92f6bf2a"]]);export{Ke as default};
