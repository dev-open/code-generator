import{u as E,c as G,g as J,d as K}from"./template-CMjDBlDr.js";import{j as M,r as h,a as L,I as n,s as $,C as O,H as e,J as p,G as a,M as T,q as r,N as j,K as Q,L as X,_ as W,v as Y,k as A,O as Z}from"./index-D44JGiXO.js";import{u as ee,a as ae}from"./main-CMpDet3E.js";import{u as te}from"./search-BED3f8Kq.js";import"./request-ChAdx2Kn.js";const q=F=>(Q("data-v-588952fe"),F=F(),X(),F),oe=q(()=>r("div",null,[r("p",null,"路径部分以/分割，不能以/开始和结束，支持的字符：英数字_-"),r("p",null,"支持参数填充，参数用${}包裹，支持的字符：英数字，例如：${controllerId}，示例："),r("p",null,"src/main/java/controller/${controllerId}Controller.java")],-1)),ne={class:"template-upload-container"},le=q(()=>r("div",{class:"upload-container"},[r("div",null,[p(" 拖拽文件到此处或 "),r("span",{style:{color:"#3370ff"}},"点击上传")])],-1)),ie=q(()=>r("div",null,[p(" 支持 ftl 格式的模板文件，模板文件的编写，参照："),r("a",{style:{color:"#3370ff"},href:"http://freemarker.foofun.cn/",target:"_blank"},"FreeMarker")],-1)),se={class:"template-upload-container"},re=q(()=>r("div",{class:"upload-container"},[r("div",null,[p(" 拖拽文件到此处或 "),r("span",{style:{color:"#3370ff"}},"点击上传")])],-1)),de=q(()=>r("div",null,[p(" 可选，支持 json 格式，文件内容示例： "),r("p",null,' [ { "name": "参数名（字符串）", "value": "参数值（任意类型）", "defaultValue": "默认值（任意类型）", "desc": "描述（字符串）", "enable": "是否启用（true 或 false）" } ] ')],-1)),pe=M({__name:"UploadTemplate",emits:["upload-success"],setup(F,{expose:o,emit:C}){const _=h(!1),f=h(!1);let k=0;const s=L({projId:k,targetPath:"",templateFile:void 0,parameterFile:void 0}),v=C,b=h(),m={targetPath:[{required:!0,message:"生成代码的目标路径为必填项"},{validator:(i,l)=>{i.trim().length===0?l("生成代码的目标路径不能为空"):l()}}],templateFile:[{required:!0,message:"模板文件为必须上传的文件"}]},R=h(),N=h(),g=i=>{i.length>0?s.templateFile=i[0].file:s.templateFile=void 0},c=i=>new Promise((l,w)=>{i.name.endsWith(".ftl")?l(!0):(j.warning("请上传.ftl文件"),l(!1))}),P=i=>{i.length>0?s.parameterFile=i[0].file:s.parameterFile=void 0},S=i=>new Promise((l,w)=>{i.name.endsWith(".json")?l(!0):(j.warning("请上传.json文件"),l(!1))}),U=()=>{b.value.validate(i=>{if(i)j.warning("表单校验未通过，不可提交");else{f.value=!0;const l=new FormData;l.append("projId",k.toString()),l.append("targetPath",s.targetPath),s.templateFile!==void 0&&l.append("templateFile",s.templateFile),s.parameterFile!==void 0&&l.append("parameterFile",s.parameterFile),E(l).then(w=>{j.success("上传成功"),v("upload-success"),d()}).finally(()=>{f.value=!1})}})},t=i=>{_.value=!0,k=i},d=()=>{_.value=!1,b.value.resetFields()};return o({init:t}),(i,l)=>{const w=n("a-input"),z=n("a-form-item"),I=n("a-upload"),y=n("a-form"),x=n("a-button"),H=n("a-space"),B=n("a-modal");return $(),O(B,{width:"auto",visible:_.value,onCancel:d,unmountOnClose:""},{title:e(()=>[p("上传模板")]),footer:e(()=>[a(H,null,{default:e(()=>[a(x,{onClick:U,type:"primary",loading:f.value},{default:e(()=>[p(T(f.value?"处理中，请稍后":"上传"),1)]),_:1},8,["loading"])]),_:1})]),default:e(()=>[a(y,{ref_key:"uploadFormRef",ref:b,model:s,rules:m,style:{width:"800px"}},{default:e(()=>[a(z,{field:"targetPath",label:"生成代码的目标路径",required:"","validate-trigger":"blur"},{extra:e(()=>[oe]),default:e(()=>[a(w,{"max-length":100,"allow-clear":"","show-word-limit":"",modelValue:s.targetPath,"onUpdate:modelValue":l[0]||(l[0]=D=>s.targetPath=D),placeholder:"输入生成代码的目标路径"},null,8,["modelValue"])]),_:1}),a(z,{field:"templateFile",label:"模板文件",required:""},{extra:e(()=>[ie]),default:e(()=>[r("div",ne,[a(I,{draggable:"",ref_key:"templateFileUploadRef",ref:R,onChange:g,onBeforeUpload:c,"auto-upload":!1,limit:1,accept:".ftl"},{"upload-button":e(()=>[le]),_:1},512)])]),_:1}),a(z,{label:"参数文件"},{extra:e(()=>[de]),default:e(()=>[r("div",se,[a(I,{draggable:"",ref_key:"parameterFileUploadRef",ref:N,onChange:P,onBeforeUpload:S,"auto-upload":!1,limit:1,accept:".json"},{"upload-button":e(()=>[re]),_:1},512)])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])}}}),ce=W(pe,[["__scopeId","data-v-588952fe"]]),ue=M({__name:"AddProj",emits:["create-success"],setup(F,{expose:o,emit:C}){const _=h(!1),f=h(!1),k=C,s=h(),v=L({projName:void 0,desc:void 0}),b={projName:[{required:!0,message:"工程名为必填项"},{validator:(g,c)=>{g.trim().length===0?c("工程名不能为空"):c()}}],desc:[{validator:(g,c)=>{g&&g.trim().length===0?c("描述不能为空"):c()}}]},m=()=>{_.value=!1,s.value.resetFields()},R=()=>{s.value.validate(g=>{g?j.warning("表单校验未通过，不可提交"):(f.value=!0,G(v).then(c=>{j.success("创建成功"),m(),k("create-success")}).finally(()=>{f.value=!1}))})};return o({init:()=>{_.value=!0}}),(g,c)=>{const P=n("a-input"),S=n("a-form-item"),U=n("a-textarea"),t=n("a-form"),d=n("a-button"),i=n("a-space"),l=n("a-modal");return $(),O(l,{width:"auto",visible:_.value,onCancel:m,unmountOnClose:""},{title:e(()=>[p("创建工程")]),footer:e(()=>[a(i,null,{default:e(()=>[a(d,{type:"primary",loading:f.value,onClick:R},{default:e(()=>[p(T(f.value?"处理中，请稍后":"创建"),1)]),_:1},8,["loading"])]),_:1})]),default:e(()=>[a(t,{ref_key:"formRef",ref:s,model:v,rules:b,style:{width:"600px"}},{default:e(()=>[a(S,{field:"projName",label:"工程名",required:"","validate-trigger":"blur"},{default:e(()=>[a(P,{"max-length":50,"allow-clear":"","show-word-limit":"",modelValue:v.projName,"onUpdate:modelValue":c[0]||(c[0]=w=>v.projName=w),placeholder:"输入工程名"},null,8,["modelValue"])]),_:1}),a(S,{field:"desc",label:"描述"},{default:e(()=>[a(U,{"max-length":150,"allow-clear":"","show-word-limit":"",modelValue:v.desc,"onUpdate:modelValue":c[1]||(c[1]=w=>v.desc=w),"auto-size":{minRows:2,maxRows:5},placeholder:"输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])}}}),me={class:"operator-container"},_e={key:0},fe={key:1},ge=M({__name:"index",setup(F){const o=L({loading:!1,dataList:[],selectedRow:[],pagination:{total:0,current:1,pageSize:10,showPageSize:!0,showTotal:!0}}),C=h(!1),_=ae(),f=h(),k=h();Y(()=>{const t=ee();t.query.current&&(o.pagination.current=Number(t.query.current)),t.query.pageSize&&(o.pagination.pageSize=Number(t.query.pageSize)),t.query.selectedRow&&(o.selectedRow=[t.query.selectedRow]),m("")}),te().$subscribe((t,d)=>{m(d.projName)});const v=t=>{o.pagination.current=t,m("")},b=t=>{o.pagination.pageSize=t,m("")},m=t=>{o.loading=!0,J(t,o.pagination.current,o.pagination.pageSize).then(d=>{o.dataList=d.data.pageData,o.pagination.total=d.data.total}).finally(()=>{o.loading=!1})},R=t=>{_.push({path:"/ui/template/view",query:{projId:t.id,projName:t.name,current:o.pagination.current,pageSize:o.pagination.pageSize}})},N=t=>{_.push({path:"/ui/template/parameter",query:{projId:t.id,projName:t.name,current:o.pagination.current,pageSize:o.pagination.pageSize}})},g=t=>{_.push({path:"/ui/template/generator",query:{projId:t.id,projName:t.name,current:o.pagination.current,pageSize:o.pagination.pageSize}})},c=t=>{f.value.init(t)},P=(t,d)=>{Z.warning({title:"操作确认",content:`此操作将不可恢复，确定删除工程：${d} ?`,okLoading:C.value,hideCancel:!1,onOk:()=>{C.value=!0,K(t).then(i=>{j.success("删除成功"),m("")}).finally(()=>{C.value=!1})}})},S=()=>{k.value.init()},U=()=>{o.selectedRow=[],o.pagination.current=1,o.pagination.pageSize=10,_.push("/ui/template"),m("")};return(t,d)=>{const i=n("icon-plus"),l=n("a-button"),w=n("icon-refresh"),z=n("a-space"),I=n("a-link"),y=n("a-table-column"),x=n("a-doption"),H=n("a-dropdown-button"),B=n("a-table"),D=n("a-card");return $(),O(D,null,{default:e(()=>[r("div",me,[a(z,null,{default:e(()=>[a(l,{type:"primary",onClick:S},{icon:e(()=>[a(i)]),default:e(()=>[p("创建工程")]),_:1}),a(l,{type:"primary",onClick:U},{icon:e(()=>[a(w)]),default:e(()=>[p("重置")]),_:1})]),_:1})]),a(B,{data:o.dataList,loading:o.loading,pagination:o.pagination,"selected-keys":o.selectedRow,"row-key":"name",onPageChange:v,onPageSizeChange:b},{columns:e(()=>[a(y,{title:"工程名"},{cell:e(({record:u})=>[a(I,{href:u.webUrl,icon:""},{default:e(()=>[p(T(u.name),1)]),_:2},1032,["href"])]),_:1}),a(y,{title:"描述",ellipsis:"",tooltip:""},{cell:e(({record:u})=>[u.description?($(),A("span",_e,T(u.description),1)):($(),A("span",fe,"-"))]),_:1}),a(y,{title:"作者","data-index":"author"}),a(y,{title:"版本","data-index":"version"}),a(y,{title:"创建时间","data-index":"createdAt"}),a(y,{title:"操作"},{cell:e(({record:u})=>[a(H,{onClick:V=>g(u)},{content:e(()=>[a(x,{onClick:V=>R(u)},{default:e(()=>[p("查看模板")]),_:2},1032,["onClick"]),a(x,{onClick:V=>N(u)},{default:e(()=>[p("查看参数")]),_:2},1032,["onClick"]),a(x,{onClick:V=>c(u.id)},{default:e(()=>[p("上传模板")]),_:2},1032,["onClick"]),a(x,{onClick:V=>P(u.id,u.name)},{default:e(()=>[p("删除工程")]),_:2},1032,["onClick"])]),default:e(()=>[p(" 生成代码 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","loading","pagination","selected-keys"]),a(ce,{ref_key:"uploadTemplateRef",ref:f,onUploadSuccess:d[0]||(d[0]=u=>m(""))},null,512),a(ue,{ref_key:"addProjRef",ref:k,onCreateSuccess:d[1]||(d[1]=u=>m(""))},null,512)]),_:1})}}}),Ce=W(ge,[["__scopeId","data-v-8cff8c98"]]);export{Ce as default};
