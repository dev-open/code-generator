import{s as J}from"./request-DlYiW6MC.js";import{j,r as _,I as n,s as h,C as Q,H as t,G as a,q as C,N,_ as B,a as D,k as $,P as E,J as m,M as q}from"./index-D44JGiXO.js";const A=f=>J.post("/parameter-util/tables",f),G=f=>J.get("/parameter-util/entity",{params:f}),H={class:"view-parameter-json-container"},K={class:"operation-box"},W={class:"editor-box"},X=j({__name:"ViewParameter",setup(f,{expose:v}){const s=_(!1),i=_(!1),d=_("");let x,V;const y=async(o,e)=>{x=o,V=e,await T()&&(s.value=!0)},T=async()=>{i.value=!0;const o=await G({tableName:x,accessToken:V}).then(e=>e.data.length>0?(d.value=e.data[0],!0):(N.warning("无模板参数内容"),b(),!1)).catch(e=>(b(),!1));return i.value=!1,o},b=()=>{s.value=!1,d.value=""},P=o=>{if(navigator.clipboard&&window.isSecureContext)navigator.clipboard.writeText(o),N.success("已复制到剪切板");else{const e=document.createElement("textarea");e.value=o,document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),e.remove(),N.success("已复制到剪切板")}};return v({init:y}),(o,e)=>{const p=n("icon-copy"),R=n("a-button"),r=n("a-tooltip"),u=n("monaco-editor"),c=n("a-spin"),g=n("a-modal");return h(),Q(g,{title:"实体参数内容",width:"1000px",visible:s.value,onCancel:b,unmountOnClose:"",simple:"",footer:!1},{default:t(()=>[a(c,{loading:i.value,tip:"处理中，请稍后",style:{width:"100%"}},{default:t(()=>[C("div",H,[C("div",K,[a(r,{content:"复制到剪切板"},{default:t(()=>[a(R,{type:"text",size:"small",onClick:e[0]||(e[0]=w=>P(d.value))},{icon:t(()=>[a(p)]),_:1})]),_:1})]),C("div",W,[a(u,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=w=>d.value=w),editorOption:{readOnly:!0},language:"json"},null,8,["modelValue"])])])]),_:1},8,["loading"])]),_:1},8,["visible"])}}}),Y=B(X,[["__scopeId","data-v-937a21df"]]),Z={class:"form-operation-container"},ee={key:0},ae={key:1},te=j({__name:"index",setup(f){const v=_(),s=D({host:void 0,port:void 0,dbName:void 0,username:void 0,password:void 0,schema:void 0,catalog:void 0,tableName:void 0,dbType:"0"}),i=_(!1),d=_([]),x=()=>{v.value.validate(o=>{o?N.warning("表单校验未通过，不可提交"):(i.value=!0,A(s).then(e=>{d.value=e.data}).catch(()=>{d.value=[]}).finally(()=>{i.value=!1}))})},V=(o,e)=>`/code/gen/api/parameter-util/entity/download?tableName=${o}&accessToken=${e}`,y=_(),T=(o,e)=>{y.value.init(o,e)},b=()=>{v.value.resetFields(),d.value=[]},P={host:[{required:!0,message:"主机为必填项"},{validator:(o,e)=>{o.trim().length===0?e("主机不能为空"):e()}}],port:[{required:!0,message:"端口为必填项"},{validator:(o,e)=>{o.trim().length===0?e("端口不能为空"):e()}}],dbName:[{required:!0,message:"数据库为必填项"},{validator:(o,e)=>{o.trim().length===0?e("数据库不能为空"):e()}}],username:[{required:!0,message:"用户名为必填项"},{validator:(o,e)=>{o.trim().length===0?e("用户名不能为空"):e()}}],password:[{required:!0,message:"密码为必填项"}]};return(o,e)=>{const p=n("a-option"),R=n("a-select"),r=n("a-form-item"),u=n("a-col"),c=n("a-input"),g=n("a-row"),w=n("a-input-password"),I=n("a-form"),U=n("a-button"),S=n("a-space"),z=n("a-divider"),k=n("a-table-column"),F=n("a-tag"),L=n("a-link"),M=n("a-table"),O=n("a-card");return h(),$(E,null,[a(O,null,{default:t(()=>[a(I,{model:s,rules:P,ref_key:"formRef",ref:v},{default:t(()=>[a(g,{gutter:16},{default:t(()=>[a(u,{span:8},{default:t(()=>[a(r,{field:"dbType",label:"数据库类型","label-col-flex":"80px"},{default:t(()=>[a(R,{modelValue:s.dbType,"onUpdate:modelValue":e[0]||(e[0]=l=>s.dbType=l)},{default:t(()=>[a(p,{value:"0"},{default:t(()=>[m("MySQL")]),_:1}),a(p,{value:"1"},{default:t(()=>[m("SQLServer")]),_:1}),a(p,{value:"2"},{default:t(()=>[m("PostgreSQL")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(u,{span:8},{default:t(()=>[a(r,{field:"host",label:"主机","label-col-flex":"80px","validate-trigger":"blur"},{default:t(()=>[a(c,{modelValue:s.host,"onUpdate:modelValue":e[1]||(e[1]=l=>s.host=l)},null,8,["modelValue"])]),_:1})]),_:1}),a(u,{span:8},{default:t(()=>[a(r,{field:"port",label:"端口","label-col-flex":"80px","validate-trigger":"blur"},{default:t(()=>[a(c,{modelValue:s.port,"onUpdate:modelValue":e[2]||(e[2]=l=>s.port=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(g,{gutter:16},{default:t(()=>[a(u,{span:12},{default:t(()=>[a(r,{field:"dbName",label:"数据库","label-col-flex":"80px","validate-trigger":"blur"},{default:t(()=>[a(c,{modelValue:s.dbName,"onUpdate:modelValue":e[3]||(e[3]=l=>s.dbName=l)},null,8,["modelValue"])]),_:1})]),_:1}),a(u,{span:12},{default:t(()=>[a(r,{field:"schema",label:"模式","label-col-flex":"80px","validate-trigger":"blur"},{default:t(()=>[a(c,{modelValue:s.schema,"onUpdate:modelValue":e[4]||(e[4]=l=>s.schema=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(g,{gutter:16},{default:t(()=>[a(u,{span:12},{default:t(()=>[a(r,{field:"username",label:"用户名","label-col-flex":"80px","validate-trigger":"blur"},{default:t(()=>[a(c,{modelValue:s.username,"onUpdate:modelValue":e[5]||(e[5]=l=>s.username=l)},null,8,["modelValue"])]),_:1})]),_:1}),a(u,{span:12},{default:t(()=>[a(r,{field:"password",label:"密码","label-col-flex":"80px","validate-trigger":"blur"},{default:t(()=>[a(w,{modelValue:s.password,"onUpdate:modelValue":e[6]||(e[6]=l=>s.password=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),C("div",Z,[a(S,null,{default:t(()=>[a(U,{disabled:i.value,onClick:b},{default:t(()=>[m("重置")]),_:1},8,["disabled"]),a(U,{disabled:i.value,type:"primary",onClick:x},{default:t(()=>[m("获取表信息")]),_:1},8,["disabled"])]),_:1})]),a(z,{orientation:"center"},{default:t(()=>[m("表信息")]),_:1}),a(M,{data:d.value,loading:i.value},{columns:t(()=>[a(k,{title:"表名","data-index":"tableName",ellipsis:"",tooltip:""}),a(k,{title:"注释","data-index":"comment",ellipsis:"",tooltip:""},{cell:t(({record:l})=>[l.comment?(h(),$("span",ee,q(l.comment),1)):(h(),$("span",ae,"-"))]),_:1}),a(k,{title:"类型"},{cell:t(({record:l})=>[a(F,null,{default:t(()=>[m(q(l.type),1)]),_:2},1024)]),_:1}),a(k,{title:"操作"},{cell:t(({record:l})=>[a(S,null,{default:t(()=>[a(U,{type:"outline",size:"mini",onClick:le=>T(l.tableName,l.accessToken)},{default:t(()=>[m("查看模板参数内容")]),_:2},1032,["onClick"]),a(L,{href:V(l.tableName,l.accessToken),icon:"",style:{"font-size":"12px"}},{default:t(()=>[m("下载模板参数json文件")]),_:2},1032,["href"])]),_:2},1024)]),_:1})]),_:1},8,["data","loading"])]),_:1}),a(Y,{ref_key:"viewParameterJsonRef",ref:y},null,512)],64)}}}),se=B(te,[["__scopeId","data-v-6b13076d"]]);export{se as default};
