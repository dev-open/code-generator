import{a as he,u as ge}from"./main-BXnMjZ8k.js";import{s as z}from"./request-AUxrZ8Bw.js";import{l as ye,u as ke}from"./useFullScreen-C_pV-m66.js";import{j as we,r as f,a as P,v as be,C as p,H as t,I as a,s as l,G as n,J as m,k as C,P as E,Q as q,S as N,q as d,N as V,M as Ce,K as xe,L as Se,_ as Ne}from"./index-D44JGiXO.js";const Ve=_=>z.get("/generator/parameters/"+_),Ie=(_,h)=>z.put("/template/parameters/"+_,h),Pe=_=>z.get("/generator/preview/"+_),Re=_=>(xe("data-v-50cd7a7f"),_=_(),Se(),_),je=Re(()=>d("span",{class:"parameter-title"},"生成代码",-1)),Ee={key:0,class:"step-container"},qe={class:"json-editor-container"},ze={class:"full-screen-container"},Ke={key:1,class:"step-container"},Oe={key:1,class:"download-container"},Be={class:"preview-container-left"},Te={class:"preview-container-right"},Je={class:"view-code-container"},Me={class:"copy-container"},Fe={class:"editor-container"},Ge={class:"operation-container"},Le=we({__name:"GenerateCode",setup(_){const h=f(0),R=f(""),U=he(),v=f(1),{handleFullScreen:A}=ke(),r=P([]),g=f(0),w=f([]),s=f(!1),K=f(1),O=f(10),B=f(),b=P([]),D=()=>{s.value=!0,Ve(h.value).then(e=>{b.length=0,b.push(...e.data)}).finally(()=>{s.value=!1})},j=P([]),Q=e=>{j.push(e)},$=e=>{A(j[e])},H=()=>{U.push({path:"/ui/template",query:{current:K.value,pageSize:O.value,selectedRow:R.value}})},y=P([]),T=async()=>{B.value.validate(async e=>{if(e)console.log(e),V.warning("表单校验未通过，不可提交");else{s.value=!0;const o={parameters:[]};let i=!0;try{b.forEach(k=>{const u=ye.cloneDeep(k);u.value&&(u.value=u.value.length===0?null:JSON.parse(u.value)),u.defaultValue&&(u.defaultValue=u.defaultValue.length===0?null:JSON.parse(u.defaultValue)),o.parameters.push({...u})})}catch{i=!1,V.warning("无效的JSON数据")}if(!i){s.value=!1;return}await Ie(h.value,o),v.value=Math.min(2,v.value+1),await Pe(h.value).then(k=>{y.length=0,k.data.length!==0&&(y.push(k.data),V.success("生成代码成功"))}).catch(()=>{}),s.value=!1}})},J=()=>{v.value=Math.max(1,v.value-1),y.length=0,r.length=0,g.value=0,w.value=[],j.length=0},W=e=>{e===2&&T(),e===1&&J()},X=(e,o)=>{Y(o.selectedNodes[0]),g.value=o.selectedNodes[0].id,w.value=[o.selectedNodes[0].id]},Y=e=>{e.children.length===0&&!r.includes(e)&&r.push(e)},Z=e=>{const o=r.findIndex(i=>i.id===e);if(o!==-1){const i=r.splice(o,1);i.length=0,i.push(...i),g.value===e&&(r.length>0?(g.value=r[r.length-1].id,w.value=[r[r.length-1].id]):(g.value=0,w.value=[]))}},ee=e=>{g.value=e,w.value=[e]},te=e=>{if(navigator.clipboard&&window.isSecureContext)navigator.clipboard.writeText(e),V.success("已复制到剪切板");else{const o=document.createElement("textarea");o.value=e,document.body.appendChild(o),o.focus(),o.select(),document.execCommand("copy"),o.remove(),V.success("已复制到剪切板")}};return be(()=>{const e=ge();h.value=Number(e.query.projId),R.value=e.query.projName,K.value=e.query.current,O.value=e.query.pageSize,D()}),(e,o)=>{const i=a("a-step"),k=a("a-steps"),u=a("a-alert"),ae=a("icon-fullscreen"),I=a("a-button"),M=a("a-tooltip"),F=a("monaco-editor"),ne=a("a-form-item"),oe=a("a-form"),G=a("a-spin"),L=a("a-empty"),le=a("a-link"),se=a("a-tree"),ce=a("icon-info-circle-fill"),re=a("icon-copy"),ie=a("a-tab-pane"),ue=a("a-tabs"),de=a("a-split"),_e=a("IconLeft"),pe=a("IconRight"),ve=a("a-space"),fe=a("a-page-header"),me=a("a-card");return l(),p(me,null,{default:t(()=>[n(fe,{subtitle:R.value,onBack:H},{title:t(()=>[je]),default:t(()=>[n(k,{type:"arrow",changeable:"",onChange:W,current:v.value},{default:t(()=>[n(i,{description:"填写生成代码所需的参数"},{default:t(()=>[m("设置参数")]),_:1}),n(i,{description:"预览/下载生成的代码"},{default:t(()=>[m("生成代码")]),_:1})]),_:1},8,["current"]),v.value===1?(l(),C("div",Ee,[n(G,{loading:s.value,tip:"处理中，请稍后",style:{width:"100%"}},{default:t(()=>[b.length===0&&!s.value?(l(),p(u,{key:0,center:"",type:"warning"},{default:t(()=>[m("无可用的模板参数")]),_:1})):(l(),p(oe,{key:1,model:b,layout:"vertical",ref_key:"formRef",ref:B},{default:t(()=>[(l(!0),C(E,null,q(b,(c,x)=>(l(),p(ne,{key:x,label:c.name},{extra:t(()=>[d("div",null,Ce(c.desc),1)]),default:t(()=>[d("div",qe,[d("div",ze,[n(M,{content:"进入全屏模式"},{default:t(()=>[n(I,{type:"text",size:"small",onClick:S=>$(x)},{icon:t(()=>[n(ae)]),_:2},1032,["onClick"])]),_:2},1024)]),d("div",{class:"editor",ref_for:!0,ref:Q},[n(F,{modelValue:c.value,"onUpdate:modelValue":S=>c.value=S,editorOption:{minimap:{enabled:!1}},language:"json"},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1032,["label"]))),128))]),_:1},8,["model"]))]),_:1},8,["loading"])])):N("",!0),v.value===2?(l(),C("div",Ke,[n(G,{loading:s.value,tip:"处理中，请稍后",style:{width:"100%"}},{default:t(()=>[y.length===0&&!s.value?(l(),p(L,{key:0},{default:t(()=>[m(" 无代码生成，请检查模板文件和参数 ")]),_:1})):N("",!0),y.length!=0&&!s.value?(l(),C("div",Oe,[n(le,{href:"/code/gen/api/generator/download/"+h.value,icon:""},{default:t(()=>[m("下载")]),_:1},8,["href"])])):N("",!0),y.length!=0&&!s.value?(l(),p(de,{key:2,class:"preview-container","default-size":.2,min:"300"},{first:t(()=>[d("div",Be,[(l(!0),C(E,null,q(y,(c,x)=>(l(),p(se,{key:x,selectedKeys:w.value,fieldNames:{key:"id",title:"name"},onSelect:X,data:c,"show-line":""},null,8,["selectedKeys","data"]))),128))])]),second:t(()=>[d("div",Te,[r.length===0?(l(),p(L,{key:0},{image:t(()=>[n(ce)]),default:t(()=>[m(" 选择文件开始预览 ")]),_:1})):(l(),p(ue,{key:1,activeKey:g.value,editable:"","auto-switch":"",onDelete:Z,onChange:ee},{default:t(()=>[(l(!0),C(E,null,q(r,(c,x)=>(l(),p(ie,{key:c.id,title:c.path},{default:t(()=>[d("div",Je,[d("div",Me,[n(M,{content:"复制到剪切板"},{default:t(()=>[n(I,{type:"text",size:"small",onClick:S=>te(c.code)},{icon:t(()=>[n(re)]),_:2},1032,["onClick"])]),_:2},1024)]),d("div",Fe,[n(F,{modelValue:c.code,"onUpdate:modelValue":S=>c.code=S,filename:c.path,editorOption:{readOnly:!0}},null,8,["modelValue","onUpdate:modelValue","filename"])])])]),_:2},1032,["title"]))),128))]),_:1},8,["activeKey"]))])]),_:1})):N("",!0)]),_:1},8,["loading"])])):N("",!0),d("div",Ge,[n(ve,{size:"large"},{default:t(()=>[n(I,{type:"secondary",disabled:v.value<=1||s.value,onClick:J},{default:t(()=>[n(_e),m(" 设置参数 ")]),_:1},8,["disabled"]),n(I,{type:"primary",disabled:v.value>=2||s.value,onClick:T},{default:t(()=>[m(" 生成代码 "),n(pe)]),_:1},8,["disabled"])]),_:1})])]),_:1},8,["subtitle"])]),_:1})}}}),$e=Ne(Le,[["__scopeId","data-v-50cd7a7f"]]);export{$e as default};
